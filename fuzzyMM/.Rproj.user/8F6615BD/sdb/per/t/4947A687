{
    "contents" : "## Subsequent MapMatching Process (SMP-1) along a link \nsmp1 <- function (traj, roads = \"DigitalRoadNetwork\", \n                  current_link, pt_index = \"numeric\") {\n  \n  last_fix <- cbind(traj$coords.x1[pt_index - 1], traj$coords.x2[pt_index - 1])\n  current_pt <- cbind(traj$coords.x1[pt_index], traj$coords.x2[pt_index])\n  edge_id <- current_link$edge_id\n    \n  if (0 <= current_link$direction && current_link$direction <= 180) {\n    current_link_end <- ifelse(V(roads@g)[name == current_link$V1]$lon \n                               >= V(roads@g)[name == current_link$V2]$lon\n                               ,current_link$V1, current_link$V2)\n  } else {\n    current_link_end <- ifelse(V(roads@g)[name == current_link$V1]$lon \n                               < V(roads@g)[name == current_link$V2]$lon\n                               ,current_link$V1, current_link$V2)\n  }\n  \n  # location of the current position fix, relative to the link, as seen from\n  # the last matched position\n  alpha <- abs(bearing(last_fix, current_pt) - current_link$direction)\n  \n  # location of the current position fix, relative to the link, as seen from\n  # the downstream junction\n  beta <- abs(bearing(current_pt, cbind(V(roads@g)[name == current_link_end]$lon,\n                                    V(roads@g)[name == current_link_end]$lat))\n              - current_link$direction)\n  \n  # Heading increment\n  HI <- abs(traj$GPS.Bearing[pt_index] - traj$GPS.Bearing[pt_index - 1])\n  \n  # Distance from the last fix to the downstream junction (m)\n  d1 <- spDists(last_fix, cbind(V(roads@g)[name == current_link_end]$lon,\n                                V(roads@g)[name == current_link_end]$lat), \n                longlat = TRUE) * 1000\n  \n  # Distance travelled since last position fix\n  t <- as.double(traj$time[pt_index] - traj$time[pt_index-1])\n  d2 <- (traj$Speed[pt_index]/3.6) * t\n  \n  # the difference between the distance from the last matched position to\n  # the downstream junction and the distance travelled by the vehicle since\n  # the last position fix\n  delta_d <- d1 - d2\n  \n  speed <- traj$GPS.Speed[pt_index] / 3.6\n  hdop <- traj$GPS.HDOP[pt_index]\n  newdata <- cbind(speed, hdop, alpha, beta, delta_d, HI, HI)\n  fis2 <- get(\"fis2\", envir = cacheEnv)\n  \n  # Sometimes warnings are produced saying the data is out of the specified range,\n  # but these have no negativ impact on the link identification\n  pred_val <- predict(fis2, newdata)\n  \n  # Probability of matching the psotion fix on the current link\n  pred_val\n}\n\n\n",
    "created" : 1390302253555.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4150238607",
    "id" : "4947A687",
    "lastKnownWriteTime" : 1393596592,
    "path" : "D:/Dropbox/Bachelorarbeit/package/fuzzyMM/R/SMP1.R",
    "project_path" : "R/SMP1.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}